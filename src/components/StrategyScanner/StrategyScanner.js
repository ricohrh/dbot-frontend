import React, { useState, useEffect } from 'react';
import { strategyService } from '../../services/strategyService';
import CopyableAddress from '../common/CopyableAddress';
import './StrategyScanner.css';

const StrategyScanner = () => {
  const [strategyConfig, setStrategyConfig] = useState({
    timeRange: '3h-6h',
    minHolders: 1200,
    minVolume: 1000,
    minMarketCap: 50000,
    chain: 'solana'
  });
  
  const [scanResults, setScanResults] = useState(null);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState(null);
  const [selectedToken, setSelectedToken] = useState(null);
  const [tokenAnalysis, setTokenAnalysis] = useState(null);
  const [analysisLoading, setAnalysisLoading] = useState(false);
  const [walletAnalysis, setWalletAnalysis] = useState(null);
  const [walletLoading, setWalletLoading] = useState(false);
  const [showBundlerList, setShowBundlerList] = useState(false);
  
  // Êñ∞Â¢ûÁä∂ÊÄÅ
  const [tradingDecision, setTradingDecision] = useState(null);
  const [decisionLoading, setDecisionLoading] = useState(false);
  const [qualityTokens, setQualityTokens] = useState(null);
  const [qualityLoading, setQualityLoading] = useState(false);
  const [opportunities, setOpportunities] = useState(null);
  const [opportunitiesLoading, setOpportunitiesLoading] = useState(false);

  // Êñ∞Â¢ûÔºöRSI ‰∫åÁ∫ßÁ≠õÈÄâÈÖçÁΩÆ
  const [rsiFilter, setRsiFilter] = useState('none'); // none | oversold | overbought
  const [rsiThreshold, setRsiThreshold] = useState(35); // 30/35/40
  const [rsiInterval, setRsiInterval] = useState('5m'); // 5m | 15m | 1h

  const presets = strategyService.getStrategyPresets();

  const handlePresetChange = (presetKey) => {
    const preset = presets[presetKey];
    setStrategyConfig({
      ...strategyConfig,
      timeRange: preset.timeRange,
      minHolders: preset.minHolders,
      minVolume: preset.minVolume
    });
  };

  const handleScan = async () => {
    setLoading(true);
    setError(null);
    setScanResults(null);
    
    try {
      const result = await strategyService.scanStrategyTokens(strategyConfig);
      setScanResults(result);
    } catch (err) {
      setError(err.message || 'Êâ´ÊèèÂ§±Ë¥•');
    } finally {
      setLoading(false);
    }
  };

  // Êñ∞Â¢ûÔºöÊâ´Êèè‰ºòË¥®‰ª£Â∏Å
  const handleScanQuality = async () => {
    setQualityLoading(true);
    setError(null);
    setQualityTokens(null);
    
    try {
      const result = await strategyService.scanQualityTokens(strategyConfig.chain, 60, 10);
      setQualityTokens(result);
    } catch (err) {
      setError(err.message || '‰ºòË¥®‰ª£Â∏ÅÊâ´ÊèèÂ§±Ë¥•');
    } finally {
      setQualityLoading(false);
    }
  };

  // Êñ∞Â¢ûÔºöÊâ´Êèè‰∫§ÊòìÊú∫‰ºö
  const handleScanOpportunities = async () => {
    setOpportunitiesLoading(true);
    setError(null);
    setOpportunities(null);
    
    try {
      const result = await strategyService.scanTradingOpportunities(
        strategyConfig.chain,
        '6h',
        rsiFilter,
        rsiInterval,
        rsiThreshold
      );
      setOpportunities(result);
    } catch (err) {
      setError(err.message || '‰∫§ÊòìÊú∫‰ºöÊâ´ÊèèÂ§±Ë¥•');
    } finally {
      setOpportunitiesLoading(false);
    }
  };

  const handleTokenAnalysis = async (token) => {
    setSelectedToken(token);
    setAnalysisLoading(true);
    setTokenAnalysis(null);
    setWalletAnalysis(null);
    setTradingDecision(null);
    
    try {
      const analysis = await strategyService.analyzeTokenStrategy(token.mint || token._id, strategyConfig.chain);
      setTokenAnalysis(analysis);
    } catch (err) {
      setError(err.message || 'ÂàÜÊûêÂ§±Ë¥•');
    } finally {
      setAnalysisLoading(false);
    }
  };

  // Êñ∞Â¢ûÔºöËé∑Âèñ‰∫§ÊòìÂÜ≥Á≠ñÂàÜÊûê
  const handleTradingDecision = async () => {
    if (!selectedToken) return;
    
    setDecisionLoading(true);
    setTradingDecision(null);
    
    try {
      const decision = await strategyService.getTradingDecision(selectedToken.mint || selectedToken._id, strategyConfig.chain);
      setTradingDecision(decision);
    } catch (err) {
      setError(err.message || '‰∫§ÊòìÂÜ≥Á≠ñÂàÜÊûêÂ§±Ë¥•');
    } finally {
      setDecisionLoading(false);
    }
  };

  const handleWalletAnalysis = async () => {
    if (!selectedToken) return;
    
    setWalletLoading(true);
    setWalletAnalysis(null);
    
    try {
      const analysis = await strategyService.analyzeHolderWallets(selectedToken.mint || selectedToken._id, strategyConfig.chain);
      setWalletAnalysis(analysis);
    } catch (err) {
      setError(err.message || 'Èí±ÂåÖÂàÜÊûêÂ§±Ë¥•');
    } finally {
      setWalletLoading(false);
    }
  };

  const renderStrategyCard = (token) => {
    const score = token.strategy_score;
    const scoreColor = score.total_score >= 85 ? '#00b894' : 
                      score.total_score >= 75 ? '#fdcb6e' : 
                      score.total_score >= 65 ? '#e17055' : '#d63031';
    
    return (
      <div key={token._id} className="strategy-token-card" onClick={() => handleTokenAnalysis(token)}>
        <div className="token-header">
          <div className="token-info">
            <h3>{token.symbol || token.name}</h3>
            <p>{token.name}</p>
            <CopyableAddress address={token.mint || token._id} className="token-address" />
          </div>
          <div className="score-badge" style={{ backgroundColor: scoreColor }}>
            {score.total_score}
          </div>
        </div>
        
        <div className="token-metrics">
          <div className="metric">
            <span className="label">ÊåÅÊúâ‰∫∫Êï∞</span>
            <span className="value">{token.holders?.toLocaleString()}</span>
            <span className="score">({score.holders_score})</span>
          </div>
          <div className="metric">
            <span className="label">1h‰∫§ÊòìÈáè</span>
            <span className="value">${token.buyAndSellVolume1h?.toLocaleString()}</span>
            <span className="score">({score.volume_score})</span>
          </div>
          <div className="metric">
            <span className="label">Â∏ÇÂÄº</span>
            <span className="value">${token.marketCap?.toLocaleString()}</span>
            <span className="score">({score.market_cap_score})</span>
          </div>
          <div className="metric">
            <span className="label">5mÊ∂®Ë∑å</span>
            <span className={`value ${token.marketCapChangeRate5m >= 0 ? 'positive' : 'negative'}`}>
              {token.marketCapChangeRate5m?.toFixed(2)}%
            </span>
            <span className="score">({score.blue_chip_score})</span>
          </div>
          <div className="metric">
            <span className="label">MEMERADAR</span>
            <span className="value">{score.memeradar_score || 0}</span>
            <span className="score">({score.memeradar_score || 0})</span>
          </div>
          <div className="metric">
            <span className="label">È≤∏È±ºÂàÜÊûê</span>
            <span className="value">{score.whale_analysis_score || 0}</span>
            <span className="score">({score.whale_analysis_score || 0})</span>
          </div>
        </div>
        
        <div className="token-links">
          {token.links?.map((link, index) => (
            <a key={index} href={link.url} target="_blank" rel="noopener noreferrer" className="link-btn">
              {link.label}
            </a>
          ))}
        </div>
      </div>
    );
  };

  // Êñ∞Â¢ûÔºöÊ∏≤Êüì‰ºòË¥®‰ª£Â∏ÅÂç°Áâá
  const renderQualityTokenCard = (token) => {
    const confidenceColor = token.confidence >= 80 ? '#00b894' : 
                           token.confidence >= 60 ? '#fdcb6e' : 
                           token.confidence >= 40 ? '#e17055' : '#d63031';
    
    return (
      <div key={token.token_mint} className="strategy-token-card quality-card">
        <div className="token-header">
          <div className="token-info">
            <h3>{token.symbol}</h3>
            <p>{token.name}</p>
            <CopyableAddress address={token.token_mint} className="token-address" />
          </div>
          <div className="score-badge" style={{ backgroundColor: confidenceColor }}>
            {token.confidence}%
          </div>
        </div>
        
        <div className="token-metrics">
          <div className="metric">
            <span className="label">ÂÜ≥Á≠ñ</span>
            <span className={`value ${token.decision === 'BUY' ? 'positive' : 'neutral'}`}>
              {token.decision === 'BUY' ? 'üü¢ ‰π∞ÂÖ•' : token.decision === 'HOLD' ? 'üü° ËßÇÊúõ' : 'üî¥ ÂçñÂá∫'}
            </span>
          </div>
          <div className="metric">
            <span className="label">ÊåÅÊúâ‰∫∫Êï∞</span>
            <span className="value">{token.holders?.toLocaleString()}</span>
          </div>
          <div className="metric">
            <span className="label">Â∏ÇÂÄº</span>
            <span className="value">${token.market_cap?.toLocaleString()}</span>
          </div>
          <div className="metric">
            <span className="label">1h‰∫§ÊòìÈáè</span>
            <span className="value">${token.volume_1h?.toLocaleString()}</span>
          </div>
        </div>
        
        <div className="token-signals">
          <div className="signals-section">
            <h4>‚úÖ Ê≠£Èù¢‰ø°Âè∑</h4>
            <ul>
              {token.signals?.slice(0, 3).map((signal, index) => (
                <li key={index}>{signal}</li>
              ))}
            </ul>
          </div>
          {token.warnings?.length > 0 && (
            <div className="warnings-section">
              <h4>‚ö†Ô∏è È£éÈô©Ë≠¶Âëä</h4>
              <ul>
                {token.warnings?.slice(0, 2).map((warning, index) => (
                  <li key={index}>{warning}</li>
                ))}
              </ul>
            </div>
          )}
        </div>
      </div>
    );
  };

  const renderTokenAnalysis = () => {
    if (!tokenAnalysis) return null;
    
    return (
      <div className="token-analysis-modal">
        <div className="modal-header">
          <h2>üìä {tokenAnalysis.token_info.symbol} Á≠ñÁï•ÂàÜÊûê</h2>
          <div className="header-actions">
            <button 
              type="button"
              className="trading-decision-btn"
              onClick={(e) => { e.preventDefault(); e.stopPropagation(); handleTradingDecision(); }}
              disabled={decisionLoading}
            >
              {decisionLoading ? 'üéØ ÂàÜÊûê‰∏≠...' : 'üéØ ‰∫§ÊòìÂÜ≥Á≠ñ'}
            </button>
            <button 
              type="button"
              className="wallet-analysis-btn"
              onClick={(e) => { e.preventDefault(); e.stopPropagation(); handleWalletAnalysis(); }}
              disabled={walletLoading}
            >
              {walletLoading ? 'üîç ÂàÜÊûê‰∏≠...' : 'üîç Èí±ÂåÖÂàÜÊûê'}
            </button>
            <button type="button" className="close-btn" onClick={(e) => { e.preventDefault(); e.stopPropagation(); setSelectedToken(null); }}>‚úï</button>
          </div>
        </div>
        
        <div className="modal-content">
          {/* ‰∫§ÊòìÂÜ≥Á≠ñÂàÜÊûêÁªìÊûú */}
          {tradingDecision && (
            <div className="trading-decision-section">
              <h3>üéØ ÁªºÂêà‰∫§ÊòìÂÜ≥Á≠ñÂàÜÊûê</h3>
              <div className="decision-summary">
                <div className={`decision-badge ${tradingDecision.decision.decision === 'BUY' ? 'buy' : tradingDecision.decision.decision === 'HOLD' ? 'hold' : 'sell'}`}>
                  {tradingDecision.decision.decision === 'BUY' ? 'üü¢ Âª∫ËÆÆ‰π∞ÂÖ•' : 
                   tradingDecision.decision.decision === 'HOLD' ? 'üü° Âª∫ËÆÆËßÇÊúõ' : 'üî¥ Âª∫ËÆÆÂçñÂá∫'}
                </div>
                <div className="confidence-score">
                  ÁΩÆ‰ø°Â∫¶: {tradingDecision.decision.confidence}%
                </div>
                <div className="risk-level">
                  È£éÈô©Á≠âÁ∫ß: {tradingDecision.decision.risk_level}
                </div>
              </div>
              
              <div className="decision-details">
                <div className="signals-section">
                  <h4>‚úÖ Ê≠£Èù¢‰ø°Âè∑</h4>
                  <ul>
                    {tradingDecision.decision.signals?.map((signal, index) => (
                      <li key={index}>{signal}</li>
                    ))}
                  </ul>
                </div>
                
                {tradingDecision.decision.warnings?.length > 0 && (
                  <div className="warnings-section">
                    <h4>‚ö†Ô∏è È£éÈô©Ë≠¶Âëä</h4>
                    <ul>
                      {tradingDecision.decision.warnings?.map((warning, index) => (
                        <li key={index}>{warning}</li>
                      ))}
                    </ul>
                  </div>
                )}
                
                <div className="recommendations-section">
                  <h4>üí° ‰∫§ÊòìÂª∫ËÆÆ</h4>
                  <ul>
                    {tradingDecision.decision.recommendations?.map((rec, index) => (
                      <li key={index}>{rec}</li>
                    ))}
                  </ul>
                </div>
              </div>
            </div>
          )}

          <div className="analysis-grid">
            <div className="analysis-card">
              <h3>üéØ Á≠ñÁï•ËØÑÂàÜ</h3>
              <div className="score-breakdown">
                <div className="score-item">
                  <span>ÊÄªÂàÜ</span>
                  <span className="score">
                    {(() => {
                      const score = tokenAnalysis?.strategy_score?.total_score;
                      console.log('Ê∏≤ÊüìÊÄªÂàÜ - ÂÄº:', score, 'Á±ªÂûã:', typeof score);
                      console.log('tokenAnalysis:', tokenAnalysis);
                      console.log('strategy_score:', tokenAnalysis?.strategy_score);
                      
                      // Âº∫Âà∂ÊòæÁ§∫ÔºåÊó†ËÆ∫‰ªÄ‰πàÊÉÖÂÜµ
                      if (score !== undefined && score !== null) {
                        console.log('ÊòæÁ§∫ÊÄªÂàÜ:', score);
                        return score;
                      } else {
                        console.log('ÊòæÁ§∫ÈªòËÆ§ÂÄº: 0');
                        return '0 (ÈªòËÆ§)';
                      }
                    })()}
                  </span>
                </div>
                <div className="score-item">
                  <span>ÊåÅÊúâ‰∫∫Êï∞</span>
                  <span className="score">{tokenAnalysis.strategy_score.holders_score || 0}</span>
                  <span className="actual-data">({tokenAnalysis.token_info?.holders?.toLocaleString() || 0})</span>
                </div>
                <div className="score-item">
                  <span>‰∫§ÊòìÈáè</span>
                  <span className="score">{tokenAnalysis.strategy_score.volume_score || 0}</span>
                  <span className="actual-data">(${tokenAnalysis.token_info?.buyAndSellVolume1h?.toLocaleString() || 0})</span>
                </div>
                <div className="score-item">
                  <span>Â∏ÇÂÄº</span>
                  <span className="score">{tokenAnalysis.strategy_score.market_cap_score || 0}</span>
                  <span className="actual-data">(${tokenAnalysis.token_info?.marketCap?.toLocaleString() || 0})</span>
                </div>
                <div className="score-item">
                  <span>ËìùÁ≠π</span>
                  <span className="score">{tokenAnalysis.strategy_score.blue_chip_score || 0}</span>
                  <span className="actual-data">({tokenAnalysis.token_info?.marketCapChangeRate5m?.toFixed(2) || 0}%)</span>
                </div>
                <div className="score-item">
                  <span>MEMERADAR</span>
                  <span className="score">{tokenAnalysis.strategy_score.memeradar_score || 0}</span>
                </div>
                <div className="score-item">
                  <span>È≤∏È±ºÂàÜÊûê</span>
                  <span className="score">{tokenAnalysis.strategy_score.whale_analysis_score || 0}</span>
                </div>
                <div className="score-item">
                  <span>Á§æ‰∫§</span>
                  <span className="score">{tokenAnalysis.strategy_score.social_score || 0}</span>
                </div>
                <div className="score-item">
                  <span>È£éÈô©</span>
                  <span className="score">{tokenAnalysis.strategy_score.risk_score || 0}</span>
                </div>
              </div>
            </div>

            <div className="analysis-card">
              <h3>üìà Â∏ÇÂú∫Êï∞ÊçÆ</h3>
              <div className="market-data">
                <div className="data-item">
                  <span>ÂΩìÂâç‰ª∑Ê†º</span>
                  <span>${tokenAnalysis.token_info?.tokenPriceUsd?.toFixed(8) || 'N/A'}</span>
                </div>
                <div className="data-item">
                  <span>24hÊ∂®Ë∑å</span>
                  <span className={tokenAnalysis.token_info?.priceChange24h >= 0 ? 'positive' : 'negative'}>
                    {tokenAnalysis.token_info?.priceChange24h?.toFixed(2) || 0}%
                  </span>
                </div>
                <div className="data-item">
                  <span>1hÊ∂®Ë∑å</span>
                  <span className={tokenAnalysis.token_info?.priceChange1h >= 0 ? 'positive' : 'negative'}>
                    {tokenAnalysis.token_info?.priceChange1h?.toFixed(2) || 0}%
                  </span>
                </div>
                <div className="data-item">
                  <span>5mÊ∂®Ë∑å</span>
                  <span className={tokenAnalysis.token_info?.priceChange5m >= 0 ? 'positive' : 'negative'}>
                    {tokenAnalysis.token_info?.priceChange5m?.toFixed(2) || 0}%
                  </span>
                </div>
                <div className="data-item">
                  <span>‰ª£Â∏ÅÂπ¥ÈæÑ</span>
                  <span>{tokenAnalysis.token_info?.age_hours?.toFixed(1) || 'N/A'} Â∞èÊó∂</span>
                </div>
                <div className="data-item">
                  <span>ÊµÅÂä®ÊÄßÊ±†</span>
                  <span>${tokenAnalysis.token_info?.currencyReserve?.toFixed(2) || 'N/A'}</span>
                </div>
              </div>
            </div>

            <div className="analysis-card">
              <h3>üîó Á§æ‰∫§Â™í‰Ωì</h3>
              <div className="social-links">
                <span>ÂÆòÊñπÈìæÊé•:</span>
                <span>{tokenAnalysis.token_info.links?.length || 0} ‰∏™</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    );
  };

  return (
    <div className="strategy-scanner">
      <div className="scanner-header">
        <h1>üéØ Ê≥¢ÊÆµ‰∫§ÊòìÁ≠ñÁï•Êâ´ÊèèÂô®</h1>
        <p>Âü∫‰∫é‰Ω†ÁöÑÁ≠ñÁï•Ëá™Âä®Á≠õÈÄâÁ¨¶ÂêàÊù°‰ª∂ÁöÑÁÉ≠Èó®‰ª£Â∏Å</p>
      </div>

      <div className="scanner-controls">
        <div className="preset-buttons">
          {Object.entries(presets).map(([key, preset]) => (
            <button
              key={key}
              className={`preset-btn ${strategyConfig.timeRange === preset.timeRange ? 'active' : ''}`}
              onClick={() => handlePresetChange(key)}
            >
              <div className="preset-name">{preset.name}</div>
              <div className="preset-desc">{preset.description}</div>
            </button>
          ))}
        </div>

        <div className="custom-config">
          <div className="config-group">
            <label>ÊúÄÂ∞èÊåÅÊúâ‰∫∫Êï∞:</label>
            <input
              type="number"
              value={strategyConfig.minHolders}
              onChange={(e) => setStrategyConfig({...strategyConfig, minHolders: parseInt(e.target.value)})}
            />
          </div>
          <div className="config-group">
            <label>ÊúÄÂ∞è‰∫§ÊòìÈáè:</label>
            <input
              type="number"
              value={strategyConfig.minVolume}
              onChange={(e) => setStrategyConfig({...strategyConfig, minVolume: parseInt(e.target.value)})}
            />
          </div>
          <div className="config-group">
            <label>ÊúÄÂ∞èÂ∏ÇÂÄº:</label>
            <input
              type="number"
              value={strategyConfig.minMarketCap}
              onChange={(e) => setStrategyConfig({...strategyConfig, minMarketCap: parseInt(e.target.value)})}
            />
          </div>
          {/* Êñ∞Â¢ûÔºöRSI ‰∫åÁ∫ßÁ≠õÈÄâ */}
          <div className="config-group">
            <label>RSIËøáÊª§:</label>
            <select value={rsiFilter} onChange={(e) => setRsiFilter(e.target.value)}>
              <option value="none">‰∏çÁ≠õÈÄâ</option>
              <option value="oversold">Ë∂ÖÂçñ(‚â§ÈòàÂÄº)</option>
              <option value="overbought">Ë∂Ö‰π∞(‚â•100-ÈòàÂÄº)</option>
            </select>
          </div>
          <div className="config-group">
            <label>RSIÈòàÂÄº:</label>
            <select value={rsiThreshold} onChange={(e) => setRsiThreshold(parseInt(e.target.value))}>
              <option value={30}>30</option>
              <option value={35}>35</option>
              <option value={40}>40</option>
            </select>
          </div>
          <div className="config-group">
            <label>KÁ∫øÂë®Êúü:</label>
            <select value={rsiInterval} onChange={(e) => setRsiInterval(e.target.value)}>
              <option value="5m">5m</option>
              <option value="15m">15m</option>
              <option value="1h">1h</option>
            </select>
          </div>
        </div>

        <div className="scan-buttons">
          <button className="scan-btn" onClick={handleScan} disabled={loading}>
            {loading ? 'üîç Êâ´Êèè‰∏≠...' : 'üöÄ Á≠ñÁï•Êâ´Êèè'}
          </button>
          <button className="quality-scan-btn" onClick={handleScanQuality} disabled={qualityLoading}>
            {qualityLoading ? 'üîç Êâ´Êèè‰∏≠...' : 'üíé ‰ºòË¥®‰ª£Â∏Å'}
          </button>
          <button className="opportunities-btn" onClick={handleScanOpportunities} disabled={opportunitiesLoading}>
            {opportunitiesLoading ? 'üîç Êâ´Êèè‰∏≠...' : '‚è∞ ‰∫§ÊòìÊú∫‰ºö'}
          </button>
        </div>
      </div>

      {error && (
        <div className="error-message">
          ‚ùå {error}
        </div>
      )}

      {/* Á≠ñÁï•Êâ´ÊèèÁªìÊûú */}
      {scanResults && (
        <div className="scan-results">
          <div className="results-header">
            <h2>üìä Á≠ñÁï•Êâ´ÊèèÁªìÊûú</h2>
            <div className="results-stats">
              <span>Êâ´ÊèèÊÄªÊï∞: {scanResults.total_scanned}</span>
              <span>Á¨¶ÂêàÊù°‰ª∂: {scanResults.total_filtered}</span>
            </div>
          </div>
          
          <div className="tokens-grid">
            {scanResults.tokens.map(renderStrategyCard)}
          </div>
        </div>
      )}

      {/* ‰ºòË¥®‰ª£Â∏ÅÊâ´ÊèèÁªìÊûú */}
      {qualityTokens && (
        <div className="scan-results">
          <div className="results-header">
            <h2>üíé ‰ºòË¥®‰ª£Â∏ÅÊâ´ÊèèÁªìÊûú</h2>
            <div className="results-stats">
              <span>Êâ´ÊèèÊÄªÊï∞: {qualityTokens.scanned_count}</span>
              <span>‰ºòË¥®‰ª£Â∏Å: {qualityTokens.quality_count}</span>
              <span>ÊúÄ‰ΩéÁΩÆ‰ø°Â∫¶: {qualityTokens.min_confidence}%</span>
            </div>
          </div>
          
          <div className="tokens-grid">
            {qualityTokens.tokens.map(renderQualityTokenCard)}
          </div>
        </div>
      )}

      {/* ‰∫§ÊòìÊú∫‰ºöÊâ´ÊèèÁªìÊûú */}
      {opportunities && (
        <div className="scan-results">
          <div className="results-header">
            <h2>‚è∞ ‰∫§ÊòìÊú∫‰ºöÊâ´ÊèèÁªìÊûú</h2>
            <div className="results-stats">
              <span>Êó∂Èó¥Á≠õÈÄâ: {opportunities.time_filter}</span>
              <span>RSIÁ≠õÈÄâ: {opportunities.rsi_filter}</span>
              <span>Êú∫‰ºöÊï∞Èáè: {opportunities.opportunities_count}</span>
            </div>
          </div>
          
          <div className="tokens-grid">
            {opportunities.opportunities.map(renderQualityTokenCard)}
          </div>
        </div>
      )}

      {selectedToken && (
        <div className="modal-overlay" onClick={() => setSelectedToken(null)}>
          <div className="modal-content" onClick={(e) => e.stopPropagation()}>
            {analysisLoading ? (
              <div className="loading">ÂàÜÊûê‰∏≠...</div>
            ) : (
              renderTokenAnalysis()
            )}
          </div>
        </div>
      )}
    </div>
  );
};

export default StrategyScanner; 